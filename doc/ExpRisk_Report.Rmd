---
title: 'Experience on Elicited Risk: Hypothesis and Data Analysis'
author: "Dario Trujano-Ochoa and Nir Chemaya"
date: "3/22/2022"
header-includes:
   - \usepackage{multirow}
   - \usepackage{xcolor}
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(pacman)
p_load(tidyverse)
p_load(janitor)
p_load(xtable)
```

# Data description

This dataset contains the result from 6 experimental sessions. 

```{r, echo=FALSE}
load('../data/ExperienceRisk_Sessions.RData')
#head(ExperienceRisk_Sessions)
```


```{r, include=FALSE}
Averges_per_Session <- 
  ExperienceRisk_Sessions %>% 
  group_by(Session) %>% 
  summarise(N=n(), 
            Age = mean(Age),
            Women = mean(Gender=="F"),
            G_1 = mean(Gamble.1),
            G_2 = mean(Gamble.2),
            CRT = mean(CR.Payoff),
            Correct = mean(sum_correct_payoffs_second),
            G_Change = mean(simple_diff),
            n_Even = mean(numEven_all),
            Explore = mean(explore)
            )
```

```{r,results='asis', echo=FALSE}
print(xtable(Averges_per_Session), include.rownames=FALSE, comment = FALSE)
```


## Risk elicited

In this study, the Eckle and Grossman risk elicitation task was implemented before and after the participants experience 24 realizations of the tasks. These correspond with **Gamble.1** and **Gamble.2** variables. Next table show the 6 gambles presented to the participants; events **odd** and **even** are equally probable and they had to choose only one gamble. 

![Payoff table of the gambles as presented to the participants.](Potential payments.jpg){#fig:payoffs}

Notice the expected payoff is increasing from Gamble 1 to 5, and then it decreases to 34 (the same as gamble 4), but in this case choosing gamble 6 clearly elicits risk loving preferences.

## Experience periods

The 24 experience periods correspond to realization of a gamble chosen. 
In the first 12, a gamble was pre-selected (variables **R1** to **R12**) and the participants throw two dice to determine the events (variables **E1** to **E12**) and wrote down the corresponding payoff (variables **P1** to **P12**).
In the last 12, a gamble was chosen by the participants (variables **F1** to **F12**) and the participants throw two dice to determine the events (variables **EF1** to **EF12**) and wrote down the corresponding payoff (variables **PF1** to **PF12**).
The 24 periods of realizations didn't affected the final payoff, but one of them (**Period.to.review**) was selected to check if they wrote down the correct payoff and then earned an extra dollar (**Correct.Payoff**).

# Hypothesis 

## Participants display larger levels of risk tolerance

### G2 - G1

```{r,echo=FALSE}
ggplot(data = ExperienceRisk_Sessions %>% 
         select(Gamble.1,Gamble.2) %>% 
         gather("Gamble_Order","Gamble") ) + 
  geom_bar(aes(x = factor(Gamble),fill = Gamble_Order),position="dodge")+
  labs(x = "Gamble Number", fill = "Gamble Order")
```

The direction of the change is driven mostly by people choosing gamble 3 at the beginning and moving upwards.

```{r,echo=FALSE}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_bar(aes(x = factor(Gamble.1),fill = factor(sign_gamble)),position="dodge")+
  labs(x = "Gamble Number",fill= "Directional \nChange of \nGamble")
```

The Wilcox test shows that the difference is significant at 5% when analyzing the hypothesis that Gamble 2 is greater. 
```{r}
wilcox.test(x = ExperienceRisk_Sessions$simple_diff,alternative = "greater")
```

### EP 1 - EP2

```{r,echo=FALSE}
ggplot(data = ExperienceRisk_Sessions %>% 
         select(Exp_Payoffs_G1,Exp_Payoffs_G2) %>% 
         gather("Gamble_EP","Gamble") ) + 
  geom_bar(aes(x = factor(Gamble),fill = Gamble_EP),position="dodge")+
  labs(x = "Gamble's Expected Payoff", fill = "Gamble \nExpected \nPayoff")
```

```{r,echo=FALSE}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_bar(aes(x = factor(Exp_Payoffs_G1),fill = factor(sign_exp_payoff)),position="dodge")+
  labs(x = "Gamble 1's Expected Payoff",fill= "Directional \nChange of \nGamble")
```

The Wilcox test shows that the difference is significant at 10% when analyzing the hypothesis that Gamble 2 is greater. 
```{r}
wilcox.test(x = ExperienceRisk_Sessions$diff_Exp_Payoffs,alternative = "greater")
```


```{r}
ExperienceRisk_Sessions %>% tabyl(Gamble.1,Gamble.2)
```

## Larger number of Even events will make people changing downwards

### Gamble 1 - Gamble 2
```{r}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_point(aes(x=numEven_all,y=simple_diff))
```


```{r}
m1 <- lm(simple_diff ~ 
           numEven_all,
         data = ExperienceRisk_Sessions)
summary(m1)
```

There is no significant effect of the overall number of events on the difference between Gamble 1 and 2.

### Excpected Payoff 1 - Expected Payoff 2
```{r, echo=FALSE}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_point(aes(y=diff_Exp_Payoffs,x=numEven_all))
```


```{r,echo=FALSE}
m1 <- lm(diff_Exp_Payoffs ~ 
           numEven_all,
         data = ExperienceRisk_Sessions)
summary(m1)
```

There is no significant effect of the overall number of events on the difference between Expected Payoffs in Gamble 1 and 2.

## CR predicting more changes

```{r}
ExperienceRisk_Sessions %>% 
  mutate(G1 = factor(Gamble.1),
         CRT = factor(CR.Payoff)) %>% 
  tabyl(G1,CRT)
```

### G2 - G1

```{r,echo=FALSE}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_bar(aes(x = factor(Gamble.1),fill = factor(CR.Payoff)),position="dodge")+
  labs(x = "Gamble 1",fill= "CRT \nScore")
```


```{r, echo=FALSE}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_boxplot(aes(y=simple_diff,x=factor(CR.Payoff)))
```


```{r,echo=FALSE}
m1 <- lm(simple_diff ~ 
           CR.Payoff>0,
         data = ExperienceRisk_Sessions)
summary(m1)
```

There is an effect of the CR when considering a dummy for having achieved at least one point in the test. If people got at least one point, they will increase by one the number of the gamble they chose.
This effect in not longer significant if the regression include all the levels of CRT as regressors.

```{r,echo=FALSE}
m1 <- lm(simple_diff ~ 
           CR.Payoff,
         data = ExperienceRisk_Sessions)
summary(m1)
```

### EP2 - EP1

```{r,echo=FALSE}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_bar(aes(x = factor(Exp_Payoffs_G1),fill = factor(CR.Payoff)),position="dodge")+
  labs(x = "Gamble 1' Expected Payoff",fill= "CRT \nScore")
```


```{r, echo=FALSE}
ggplot(data = ExperienceRisk_Sessions) + 
  geom_boxplot(aes(y=diff_Exp_Payoffs,x=factor(CR.Payoff)))
```


```{r,echo=FALSE}
m1 <- lm(diff_Exp_Payoffs ~ 
           CR.Payoff>0,
         data = ExperienceRisk_Sessions)
summary(m1)
```

Like in the difference between the gamble chosen first and second, there is an effect of the CR when considering a dummy for having achieved at least one point in the test. 
If people got at least one point, they will increase by one the number of the gamble they chose.

## Gender differences

## Regression

### G2- G1
```{r,echo=FALSE}
m2 <- lm(simple_diff ~ 
           Gamble.1 +
           Gender +
           CR.Payoff +
           sum_correct_payoffs+
           numEven_all+
           explore+
           Session,
         data = ExperienceRisk_Sessions)
summary(m2)
```


```{r,echo=FALSE}
m2 <- lm(simple_diff ~ 
           Gamble.1 +
           CR.Payoff +
           sum_correct_payoffs,
         data = ExperienceRisk_Sessions)
summary(m2)
```

### EP2- EP1

```{r,echo=FALSE}
m2 <- lm(diff_Exp_Payoffs ~ 
           Gamble.1 +
           Gender +
           CR.Payoff +
           sum_correct_payoffs+
           numEven_all+
           explore+
           Session,
         data = ExperienceRisk_Sessions)
summary(m2)
```

```{r,echo=FALSE}
m2 <- lm(diff_Exp_Payoffs ~ 
           Gamble.1 +
           sum_correct_payoffs,
         data = ExperienceRisk_Sessions)
summary(m2)
```


### CRT = 0

```{r,echo=FALSE}
m2 <- lm(diff_Exp_Payoffs ~ 
           Gamble.1 +
           less_than_12_even,
         data = ExperienceRisk_Sessions %>% filter(CR.Payoff==0 & Gender=="F"))
summary(m2)
```
